server {
    # Nginx escuta a porta 80 dentro do container Docker
    # Isso corresponde à correção feita no docker-compose.yml: "5173:80"
    listen 80; 

    # Define o caminho raiz onde os arquivos estáticos do Vite (pasta 'dist')
    # foram copiados pelo Dockerfile (no Stage 2)
    root /usr/share/nginx/html;
    index index.html;

    # Configuração principal para roteamento da SPA
    location / {
        # Tenta servir o arquivo solicitado diretamente (se for um asset como .js, .css, .png, etc.).
        # Se não for encontrado ($uri não existir), tenta servir o index.html.
        # Isso permite que a lógica de roteamento do Vite.js/React/Vue cuide da rota.
        try_files $uri $uri/ /index.html;
    }

    # Bloco opcional para definir cache (Altamente recomendado para performance em produção)
    # Define cabeçalhos de cache para assets estáticos que não mudam de nome (geralmente com hash no nome)
    location ~* \.(?:css(\.map)?|js(\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|mid|midi|wav|mp4|mov|webm|mpe?g|avi|ogv|dir|wmv|flv|svg)$ {
        expires 1y;
        access_log off;
    }

    # Bloco para servir arquivos estáticos de texto (HTML/JSON/XML)
    location ~* \.(?:html|json|xml)$ {
        expires 30d;
        access_log off;
    }

    # Descomente as linhas abaixo para ver logs no terminal do Docker
    # access_log /dev/stdout;
    # error_log /dev/stderr;
}